<head>
    <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script>
		var baseurl="http://localhost:1337/";



        function removeNulls(obj) {
            var isArray = obj instanceof Array;
            for (var k in obj) {
                if (obj[k] === null) isArray ? obj.splice(k, 1) : delete obj[k];
                else if (typeof obj[k] == "object") removeNulls(obj[k]);
            }
        }

        function createCookie(name, value, min) {
            if (min) {
                var date = new Date();
                date.setTime(date.getTime() + (min * 60 * 1000));
                var expires = "; expires=" + date.toGMTString();
            }
            else var expires = "";
            document.cookie = name + "=" + value + expires + "; path=/";
        }
        function readCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }
        function deleteCookie(name) {
            createCookie(name, "", -1);
        }


        $(document).ready(function () {

          function Authenticate(user, pass) {
                var tok = "";
                var crturl = baseurl+"auth/local";

				        $.ajax({
                    type: "POST",
                    async: false,
                    url: crturl,
                    data: {
                        identifier: user,
                        password: pass,
                    },
                    success: function (data) {

                        tok = 'Bearer ' + data.jwt;
                        $("#token").html(tok);
                        $("#authenticateerr").html('');
                          //tok is saved on cookie
                    },
                    error: function (data) {
                        $("#authenticateerr").html(JSON.stringify(data));
						      $("#token").html('');
                    }
                 });
                return tok;
          }

            function DemoFunction(tok) {
                $.ajax({
                    type: 'POST',
                    headers: {
                        "Authorization": tok
                    },
                    async: false,
                    url:  baseurl+"apitest",
                    success: function (data) {
                        $("#api_resp").html(JSON.stringify(data));
						$("#api_err").html('');
                    },
                    error: function (data) {
                        $("#api_err").html(JSON.stringify(data));
						$("#api_resp").html('');
                    }
                });
            }


			function UserProfileFunction(tok) {

					$qs="";
                $.ajax({
                    type: 'GET',
                    headers: {
                        "Authorization": tok
                    },
                    async: false,
                    url:  baseurl+"user-profile",
                    success: function (data) {
                      $("#api_resp").html(JSON.stringify(data));
                      $("#api_err").html('');
                    },
                  error: function (data) {
                          $("#api_err").html(JSON.stringify(data));
                      $("#api_resp").html('');
                  }
                });
         }

     function UpdateProfile(tok,strdata) {
        var fd = new FormData();
        var files = $('#file')[0].files[0];
        fd.append('files.avatar',files);
        fd.append('dataa', strdata);


        $.ajax({
            type: 'PUT',
            headers: {
                "Authorization": tok
            },
            data:fd,
            async: false,
            contentType: false,
            processData: false,
            url:  baseurl+"user-profile",
            success: function (data) {
                $("#api_resp").html(JSON.stringify(data));
						    $("#api_err").html('');
            },
            error: function (data) {
                $("#api_err").html(JSON.stringify(data));
						    $("#api_resp").html('');
                    }
                });
      }



            $("#login").click(function () {
                var userName = $('#uname1').val();
                var pwd = $('#pwd1').val();
                var Tkn = Authenticate(userName, pwd);
                createCookie('token', Tkn, 60)
            });
            $("#demo").click(function () {
                Tkn = readCookie('token');
                DemoFunction(Tkn);
            });


			$("#btn_profile").click(function () {
              Tkn = readCookie('token');
				      UserProfileFunction(Tkn);
            });





			$("#btn_updateprofile").click(function () {


        Tkn = readCookie('token');
				var payload = $('#payload').val();
          UpdateProfile(Tkn,payload);
            });


       });






function replacer(key, value) {
  return value.replace(/[^\w\s]/gi, '');
}
    </script>
</head>
<table border='1' width="100%"  cellpadding="5" style="font-family:arial;border-collapse:collapse;font-size:11px;background:#efefef">
<tr>
<td width="50%">
<h3>AUTHENTICATION </h3><br />
UserName:<br> <input type="text" id="uname1"><br />
Password:<br> <input type="password" id="pwd1"><br /><br />
<button id="login">token</button><br />
<div id="authenticateerr" style="color:red"></div> <br />
<div id="token" style="color:blue;max-width:600px"></div> <br />
<hr>

<h3>USER PROFILE</h3>
  <br />
<button id="btn_profile">Get profile</button><br />
<br />
<hr>


<h3>UPDATE PROFILE</h3>
    <form method="post" action="" enctype="multipart/form-data" id="myform">
      <input type="file" id="file" name="file" />
      <br /><br />
      <textarea  id="payload" style="width:600px;height:400px">{"contact_name":"Bubu1","referrer":"refff1"}</textarea>
     <br /><br />
    </form>
<button id="btn_updateprofile">Update profile</button><br />
<br />
<hr>
</td>
<td valign="top">
<h3>RESPONSE</h3>
<div id="api_resp" style="color:blue;max-width:600px;max-height:600px;height:200px;overflow:auto;border:1px solid #000;background:#fff"></div><br />
<h3 style="color:#FF0000">ERROR</h3>
<div id="api_err" style="color:red;max-width:600px;max-height:600px;height:100px;overflow:auto;border:1px solid #000;background:#fff"></div><br />
</td>
</tr>
</table>
